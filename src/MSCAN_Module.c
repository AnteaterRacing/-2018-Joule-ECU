/*
 * MSCAN_ModuleEn.c
 *
 *  Created on: Apr 22, 2014
 *      Author: Kitty
 */
#include "MSCAN_Module.h"
#include "derivative.h"
#include "MSCANdrv.h"
void MSCAN_ModuleEn(void)
{
	/* MSCAN Pin Select */
	SIM_PINSEL1 &= ~SIM_PINSEL1_MSCANPS_MASK;

	/*Enable clock of MSCAN0*/
	SIM_SCGC|=SIM_SCGC_MSCAN_MASK;

	/* NVIC_ICER: CLRENA31=0,CLRENA30=0,CLRENA29=0,CLRENA28=0,CLRENA27=0,CLRENA26=0,CLRENA25=0,CLRENA24=0,CLRENA23=0,CLRENA22=0,CLRENA21=0,CLRENA20=0,CLRENA19=0,CLRENA18=0,CLRENA17=0,CLRENA16=0,CLRENA15=0,CLRENA14=0,CLRENA13=0,CLRENA12=0,CLRENA11=0,CLRENA10=0,CLRENA9=0,CLRENA8=0,CLRENA7=0,CLRENA6=0,CLRENA5=0,CLRENA4=0,CLRENA3=0,CLRENA2=0,CLRENA1=0,CLRENA0=0 */
	NVIC->ICER[0] = 0x00U;

	Enable_Interrupt(MSCAN_RX_IRQn);
	Enable_Interrupt(MSCAN_TX_IRQn);
}

void MSCAN_RX_IRQHandler(void)
{
	CAN_Receive(0);
}
void MSCAN_TX_IRQHandler(void)
{
	if(MSCAN_CANTFLG & MSCAN_CANTIER)
		CAN_Transmit(0);
	if((MSCAN_CANRFLG&0x02)||((MSCAN_CANRFLG>>6)&0x01))
		CAN_ERR(0);
	if(MSCAN_CANRFLG &0x80)
		CAN_Wakeup(0);
}
